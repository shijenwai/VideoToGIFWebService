# T-20251207-003-排隊位置反饋功能

## Summary
實作排隊位置反饋機制，讓使用者上傳影片時能看到前面還有多少任務在排隊。

## Why
目前使用 `asyncio.Semaphore` 的排隊機制已實作，但使用者完全不知道自己在排隊中，體驗不佳。需要提供即時反饋讓使用者了解等待狀態。

## Scope

### In Scope
- [x] 建立 QueueTracker 類別追蹤排隊狀態
- [x] 顯示排隊位置（前面還有 X 個任務）
- [x] 輪到處理時通知使用者
- [x] 訊息中顯示影片檔名，方便使用者辨識多部影片

### Out of Scope
- 預估等待時間
- 排隊進度即時更新
- 取消排隊功能

## Acceptance Criteria
- [x] 無需排隊時顯示「正在為您轉檔中...」+ 檔名
- [x] 需要排隊時顯示「前面還有 X 個任務」+ 檔名
- [x] 輪到處理時顯示「輪到您了！正在轉檔中...」+ 檔名
- [x] 排隊計數正確（考慮等待中 + 處理中的任務）
- [x] 無檔名時顯示「未命名影片」作為 fallback

## Implementation Steps
1. 建立 `QueueTracker` 類別，包含：
   - `_waiting_count`: 等待中任務數
   - `_processing_count`: 處理中任務數
   - `join_queue()`: 加入排隊，回傳前面人數
   - `start_processing()`: 開始處理
   - `finish_processing()`: 完成處理
2. 修改 `video_to_gif_handler`：
   - 在 semaphore 等待前先加入排隊
   - 根據 position 顯示不同訊息
   - 進入 semaphore 後通知開始處理
   - finally 中呼叫 finish_processing

## Test/Validation
- [ ] 單一使用者上傳：顯示「正在轉檔中」
- [ ] 多使用者同時上傳：第二位顯示「前面還有 1 個任務」
- [ ] 排隊完成後：顯示「輪到您了」
- [ ] 確認計數器正確遞增/遞減

## Story Points
2

## Status
- [ ] 待處理
- [ ] 進行中
- [ ] 待測試
- [ ] 待審核
- [x] 已完成

## Notes
- 使用 `asyncio.Lock` 確保計數器的執行緒安全
- position 計算 = waiting_count + processing_count（代表前面所有任務）
- 修正了原始程式碼中的縮排錯誤
